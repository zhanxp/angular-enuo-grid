angular.module("enuo.grid",[]).run(["$templateCache",function(n){n.put("enuo/grid/templates/emptyResult.html",'<div class="row" ng-style="outStyle">\n    <div class="col-md-4 col-md-offset-4" ng-style="innerStyle">\n        <div class="media">\n            <div class="media-left">\n                <i style="font-size:42px;" ng-class="config.icon"></i>\n            </div>\n            <div class="media-body">\n                <h4 class="media-heading">{{ config.title }}</h4>\n                {{ config.intro }}\n            </div>\n        </div>\n    </div>\n</div>'),n.put("enuo/grid/templates/enuoGrid.html",'<div class="enuo-grid">\n    <div class="box-tool clearfix" ng-if="config.tool && config.query">\n        <div class="btn-group" ng-if="config.tool">\n            <a ng-repeat="item in config.tool.items" ng-click="item.click(config.selectedList)" ng-class="item.cssClass" class="btn">\n                <i ng-class="item.icon"></i> {{item.name}}\n            </a>\n        </div>\n        <div class="pull-right" ng-if="config.query && config.query.items.length > 0">\n            <form class="form-inline">\n                <div class="input-group">\n                    <div class="pull-left" ng-repeat="item in config.query.items">\n                        <div ng-if="item.type==\'select\'" class="input-group-btn">\n                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                                 {{ item.display }} \n                                 <span class="caret"></span>\n                            </button>\n                            <ul class="dropdown-menu">\n                                <li ng-repeat="option in item.options" ng-click="fnSelectQuery(option,item)">\n                                    <a>{{option.name}}</a>\n                                </li>\n                            </ul>\n                        </div>\n                        <input ng-if="item.type==\'input\'" type="text" ng-model="item.value" class="form-control" placeholder="{{item.placeholder}}" />\n                        <input ng-if="item.type==\'hideen\'" type="hidden" ng-model="item.value" />\n                    </div>\n                    <span class="input-group-btn pull-left">\n                        <button type="submit" ng-click="fnQuery()" class="btn btn-primary">\n                            <i class="glyphicon glyphicon-search"></i>\n                            {{config.query.action.title || \'搜索\'}}\n                        </button>\n                    </span>\n                </div>\n            </form>\n        </div>\n    </div>\n    <div class="table-responsive">\n        <table class="table table-bordered table-hover">\n            <thead>\n                <tr>\n                    <th ng-if="config.pkid" class="check">\n                        <input type="checkbox" ng-checked="checkAll" ng-click="fnCheckAll()" />\n                    </th>\n                    <th ng-repeat="column in config.columns" ng-style="{width:column.width?column.width:\'auto\'}" ng-click="!column.isSort||onSort(column, config.lastSort)" ng-class="{sort_both:(column.sort==\'both\'||!column.sort)&&column.isSort, sort_asc:column.sort==\'asc\'&&column.isSort, sort_desc:column.sort==\'desc\'&&column.isSort}">{{column.name}}</th>\n                </tr>\n            </thead>\n            <tbody ng-style="contentStyle" ng-if="!config.loading && gridSource.length > 0">\n                <tr ng-repeat="item in gridSource track by $index" ng-click="fnCheckItem(item)">\n                    <td class="check" ng-if="config.pkid">\n                        <input type="checkbox" ng-checked="fnItemChecked(item)" />\n                    </td>\n                    <td ng-repeat="column in config.columns track by $index" ng-style="{width:column.width?column.width:\'auto\'}">\n                        <enuo-grid-cell column="column" item="item" index="$index" row="$parent.$index"></enuo-grid-cell>\n                    </td>\n                </tr>\n            </tbody>\n            <tbody ng-style="contentStyle" ng-if="!config.loading && gridSource.length <= 0">\n                <tr>\n                    <td colspan="{{columnsCount }}">\n                        <empty-result></empty-result>\n                    </td>\n                </tr>\n            </tbody>\n            <tbody ng-style="contentStyle" ng-if="config.loading">\n                <tr>\n                    <td colspan="{{columnsCount }}">\n                        <empty-result em-style="loading"></empty-result>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n    <div class="box-footer" ng-if="config.page">\n        <paging page="config.page.pageIndex" class="pull-right paging" page-size="config.page.pageSize" total="config.page.total" paging-action="config.page.callback(page)" show-prev-next="true" show-first-last="true">\n        </paging>\n    </div>\n</div>')}]);
angular.module("enuo.grid").directive("paging",function(){var o=/\{page\}/g;return{restrict:"EA",link:function(a,t,s){a.$watchCollection("[page,pageSize,total,disabled]",function(t,e){!function(t,e){(!t.pageSize||t.pageSize<=0)&&(t.pageSize=1);var a,s,i=Math.ceil(t.total/t.pageSize);(function(t,e){t.List=[],t.Hide=!1,t.page=parseInt(t.page)||1,t.total=parseInt(t.total)||0,t.adjacent=parseInt(t.adjacent)||2,t.pgHref=t.pgHref||"",t.dots=t.dots||"...",t.ulClass=t.ulClass||"pagination",t.activeClass=t.activeClass||"active",t.disabledClass=t.disabledClass||"disabled",t.textFirst=t.textFirst||"<<",t.textLast=t.textLast||">>",t.textNext=t.textNext||">",t.textPrev=t.textPrev||"<",t.textFirstClass=t.textFirstClass||"",t.textLastClass=t.textLastClass||"",t.textNextClass=t.textNextClass||"",t.textPrevClass=t.textPrevClass||"",t.textTitlePage=t.textTitlePage||"Page {page}",t.textTitleFirst=t.textTitleFirst||"First Page",t.textTitleLast=t.textTitleLast||"Last Page",t.textTitleNext=t.textTitleNext||"Next Page",t.textTitlePrev=t.textTitlePrev||"Previous Page",t.hideIfEmpty=n(t,e.hideIfEmpty),t.showPrevNext=n(t,e.showPrevNext),t.showFirstLast=n(t,e.showFirstLast),t.scrollTop=n(t,e.scrollTop),t.isDisabled=n(t,e.disabled)})(t,e),function(t,e){t.page>e&&(t.page=e);t.page<=0&&(t.page=1);t.adjacent<=0&&(t.adjacent=2);e<=1&&(t.Hide=t.hideIfEmpty)}(t,i);var l=2*t.adjacent+2;r(t,i,"prev"),i<=2+l?p(a=1,i,t):t.page-t.adjacent<=2?(p(a=1,s=1+l,t),x(i,t,s)):t.page<i-(t.adjacent+2)?(a=t.page-t.adjacent,s=t.page+t.adjacent,g(t,a),p(a,s,t),x(i,t,s)):(g(t,a=(s=i)-l),p(a,s,t));r(t,i,"next")}(a,s)},!0),a.action=function(t){c(a,t)}},template:function(t,e){return'<ul data-ng-hide="Hide" data-ng-class="ulClass"> <li title="{{Item.title}}" data-ng-class="Item.liClass" data-ng-repeat="Item in List"> <a '+(e.pgHref?'data-ng-href="{{Item.pgHref}}" ':"href ")+'data-ng-class="Item.aClass" data-ng-click="Item.action()" data-ng-bind="Item.value"></a> </li><span style="margin-left:5px">跳至<input class="form-control" style="margin-left:5px;margin-right:5px;width:40px;display:inline-block" ng-model="inputPage"   type="text"  />页</span><a style="margin-left:5px" class="btn btn-primary" ng-click="action(inputPage)">go</a></ul>'},scope:{page:"=",pageSize:"=",total:"=",disabled:"@",dots:"@",ulClass:"@",activeClass:"@",disabledClass:"@",adjacent:"@",pagingAction:"&",pgHref:"@",textFirst:"@",textLast:"@",textNext:"@",textPrev:"@",textFirstClass:"@",textLastClass:"@",textNextClass:"@",textPrevClass:"@",textTitlePage:"@",textTitleFirst:"@",textTitleLast:"@",textTitleNext:"@",textTitlePrev:"@"}};function n(t,e){return!!angular.isDefined(e)&&!!t.$parent.$eval(e)}function c(t,e){t.page!=e&&(t.isDisabled||(t.page=e,t.pagingAction({page:t.page,pageSize:t.pageSize,total:t.total}),t.scrollTop&&scrollTo(0,0)))}function r(a,t,e){if(!(!a.showPrevNext&&!a.showFirstLast||t<1)){var s,i,l;if("prev"===e){s=a.page-1<=0;var n=a.page-1<=0?1:a.page-1;a.showFirstLast&&(i={value:a.textFirst,title:a.textTitleFirst,aClass:a.textFirstClass,page:1}),a.showPrevNext&&(l={value:a.textPrev,title:a.textTitlePrev,aClass:a.textPrevClass,page:n})}else{s=a.page+1>t;var r=a.page+1>=t?t:a.page+1;a.showPrevNext&&(i={value:a.textNext,title:a.textTitleNext,aClass:a.textNextClass,page:r}),a.showFirstLast&&(l={value:a.textLast,title:a.textTitleLast,aClass:a.textLastClass,page:t})}function p(t,e){return{title:t.title,aClass:t.aClass,value:t.aClass?"":t.value,liClass:e?a.disabledClass:"",pgHref:e?"":a.pgHref.replace(o,t.page),action:function(){e||c(a,t.page)}}}if(a.isDisabled&&(s=!0),i){var g=p(i,s);a.List.push(g)}if(l){var x=p(l,s);a.List.push(x)}}}function p(t,e,a){var s=0;for(s=t;s<=e;s++){var i=a.pgHref.replace(o,s),l=a.page==s?a.activeClass:"";a.isDisabled&&(i="",l=a.disabledClass),a.List.push({value:s,title:a.textTitlePage.replace(o,s),liClass:l,pgHref:i,action:function(){c(a,this.value)}})}}function s(t){t.List.push({value:t.dots,liClass:t.disabledClass})}function g(t,e){p(1,2,t),3!=e&&s(t)}function x(t,e,a){a!=t-2&&s(e),p(t-1,t,e)}});
angular.module("enuo.grid").directive("emptyResult",function(){return{restrict:"EA",scope:{height:"@",emTitle:"@",emIntro:"@",emIcon:"@",emStyle:"@"},replace:!0,templateUrl:"enuo/grid/templates/emptyResult.html",controller:["$scope","$element","$attrs",function(n,e,t){n.$watchGroup(["height","emTitle","emIntro","emIcon","emStyle"],function(e,t){n.fnUpdate()},!0),n.fnUpdate=function(){n.config={title:n.emTitle||"没有匹配的数据",icon:n.emIcon||"glyphicon glyphicon-info-sign text-yellow",intro:n.emIntro||"请尝试修改查询条件后再试一次。"},"loading"==n.emStyle&&(n.config.title="loading",n.config.intro="正在加载,请稍后...",n.config.icon="fa fa-refresh fa-spin text-muted");var e=n.height||200,t=(e-60)/2;n.outStyle={"min-height":e+"px"},n.innerStyle={"margin-top":t+"px"}}}]}});
angular.module("enuo.grid").directive("enuoGridCell",["$sce",function($sce){return{restrict:"EA",replace:!0,transclude:!0,scope:{column:"=",item:"=",index:"=",row:"="},template:'<span ng-click="click($event)" bind-html-compile="content"></span>',compile:function(){return{pre:function($scope,$elm,$attrs){function getFunc(func){return angular.isFunction(func)?func:eval("("+func+")")}var value=$scope.item[$scope.column.key];$scope.value=value;var content=value;$scope.column.format?content=getFunc($scope.column.format)(value,$scope.item):void 0===value?content=$scope.column.name:null===value&&(content=""),"add"==$scope.column.template?content="<a class='text-success text-link'><i class='glyphicon glyphicon-plus'></i> "+$scope.column.name+"</a>":"edit"==$scope.column.template?content="<a class='text-primary text-link'><i class='glyphicon glyphicon-pencil'></i> "+$scope.column.name+"</a>":"delete"==$scope.column.template?content="<a class='text-danger text-link'><i class='glyphicon glyphicon-remove'></i> "+$scope.column.name+"</a>":$scope.column.template&&(content=getFunc($scope.column.template)(value,$scope.item)),$scope.content=content},post:function($scope,$elm,$attrs){$scope.click=function($event,index){var invoke;index=index||0,$scope.column.click&&(invoke=angular.isFunction($scope.column.click)?$scope.column.click:eval("("+$scope.column.click+")"),invoke($scope.item[$scope.column.name],$scope.item,$event,index));$event.stopPropagation()}}}}}}]);
!function(){"use strict";window.angular.module("enuo.grid").directive("bindHtmlCompile",["$compile",function(c){return{restrict:"A",link:function(i,e,o){i.$watch(function(){return i.$eval(o.bindHtmlCompile)},function(n){e.html(n&&n.toString());var t=i;o.bindHtmlScope&&(t=i.$eval(o.bindHtmlScope)),c(e.contents())(t)})}}}])}();
angular.module("enuo.grid").directive("enuoGrid",function(){return{restrict:"E",replace:!0,scope:{config:"=",gridSource:"="},templateUrl:"enuo/grid/templates/enuoGrid.html",controller:["$scope","$element","$attrs",function(o,e,n){o.config.selectedList=o.config.selectedList||[],o.checkAll=!1,o.columnsCount=o.config.pkid?o.config.columns.length+1:o.config.columns.length,o.contentStyle=o.config.style?o.config.style.contentStyle:{},o.fnItemChecked=function(e){var n=e[o.config.pkid];return 0<o.config.selectedList.filter(function(e){return e[o.config.pkid]==n}).length},o.fnCheckIsAll=function(){if(!o.gridSource)return!1;var e=o.gridSource.filter(function(e){return o.fnItemChecked(e)}).length;o.checkAll=e==o.gridSource.length},o.fnCheckItem=function(e){var n=e[o.config.pkid],c=o.config.selectedList.filter(function(e){return e[o.config.pkid]==n}),t=0<c.length?c[0]:null;if(t){var i=o.config.selectedList.indexOf(t);o.config.selectedList.splice(i,1)}else o.config.selectedList.push(e);o.fnCheckIsAll()},o.fnCheckAll=function(){return o.checkAll=!o.checkAll,angular.forEach(o.gridSource,function(e,n,c){var t=e[o.config.pkid],i=o.config.selectedList.filter(function(e){return e[o.config.pkid]==t}),l=0<i.length?i[0]:null;if(o.checkAll&&!l&&o.config.selectedList.push(e),!o.checkAll&&l){n=o.config.selectedList.indexOf(l);o.config.selectedList.splice(n,1)}}),!1},o.$watch("gridSource",function(e,n){o.fnCheckIsAll()},!0),o.fnSelectQuery=function(e,n){n.value=e.value,n.display=e.display||e.name},o.fnQuery=function(){var t={};angular.forEach(o.config.query.items,function(e,n,c){t[e.key]=e.value}),o.config.query.action.callback(t)},o.onSort=function(e,n){n&&e.key!=n.key&&(n.sort=""),(o.config.lastSort=e).sort=e.sort&&"asc"!=e.sort?"asc":"desc",o.config.onSort(e.key+" "+e.sort,e)}}]}});